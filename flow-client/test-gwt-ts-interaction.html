<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>GWT-TypeScript Interaction Test</title>
</head>
<body>
    <h1>GWT-TypeScript Interaction Test</h1>
    <div id="output"></div>

    <script type="module">
        // Import TypeScript code first
        import { ArrayUtil } from './target/classes/META-INF/frontend/collections/JsArrayUtil.js';

        const output = document.getElementById('output');

        // Test 1: TypeScript code works
        const testArray = [1, 2, 3];
        const isEmpty = ArrayUtil.isEmpty(testArray);
        output.innerHTML += '<p>✓ TypeScript ArrayUtil.isEmpty([1,2,3]) = ' + isEmpty + '</p>';

        // Test 2: TypeScript is exposed on window.Vaadin.TypeScript
        if (window.Vaadin && window.Vaadin.TypeScript && window.Vaadin.TypeScript.ArrayUtil) {
            output.innerHTML += '<p>✓ window.Vaadin.TypeScript.ArrayUtil is available</p>';

            // Test 3: Can call via window (like GWT would)
            const emptyArray = [];
            const isEmptyViaWindow = window.Vaadin.TypeScript.ArrayUtil.isEmpty(emptyArray);
            output.innerHTML += '<p>✓ window.Vaadin.TypeScript.ArrayUtil.isEmpty([]) = ' + isEmptyViaWindow + '</p>';

            // Test 4: Clear array works
            const clearTest = [1, 2, 3];
            window.Vaadin.TypeScript.ArrayUtil.clear(clearTest);
            output.innerHTML += '<p>✓ ArrayUtil.clear() works, length = ' + clearTest.length + '</p>';

            output.innerHTML += '<h2 style="color: green">✓ All tests passed! GWT can call TypeScript code.</h2>';
        } else {
            output.innerHTML += '<p style="color: red">✗ window.Vaadin.TypeScript not available</p>';
        }

        // Test 5: Load GWT client code
        output.innerHTML += '<h3>Loading GWT FlowClient...</h3>';
        import('./target/classes/META-INF/frontend/FlowClient.js').then(() => {
            output.innerHTML += '<p>✓ GWT FlowClient loaded (check console for bridge message)</p>';
        }).catch(err => {
            output.innerHTML += '<p style="color: red">✗ Failed to load FlowClient: ' + err + '</p>';
        });
    </script>
</body>
</html>
